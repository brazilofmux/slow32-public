# RUN: llc -mtriple=slow32-unknown-none -run-pass=branch-folder -verify-machineinstrs %s -o - | FileCheck %s
# REQUIRES: slow32-registered-target

--- |
  define i32 @cond_fallthrough(i32 %a, i32 %b) {
  entry:
    %cmp = icmp ne i32 %a, %b
    br i1 %cmp, label %taken, label %merge
  taken:
    ret i32 2
  merge:
    ret i32 1
  }

  define void @branch_before_return() {
  entry:
    ret void
  }
...

# CHECK-LABEL: name: cond_fallthrough
# CHECK: successors: %bb.1{{[^\n]*}}%bb.2
# CHECK: BNE_pat
# CHECK-NOT: BR %bb.1
---
name:            cond_fallthrough
alignment:       4
tracksRegLiveness: true
noPhis:          true
isSSA:           false
noVRegs:         false
registers:
  - { id: 0, class: gpr }
  - { id: 1, class: gpr }
  - { id: 2, class: gpr }
  - { id: 3, class: gpr }
liveins:
  - { reg: '$r3' }
  - { reg: '$r4' }
body:             |
  bb.0:
    successors: %bb.1(0x40000000), %bb.2(0x40000000)
    liveins: $r3, $r4
    %0:gpr = COPY $r3
    %1:gpr = COPY $r4
    BNE_pat %0, %1, %bb.2
    BR %bb.1

  bb.1:
    %2:gpr = ADDI $r0, 1
    $r1 = COPY %2
    RET implicit $r1

  bb.2:
    %3:gpr = ADDI $r0, 2
    $r1 = COPY %3
    RET implicit $r1
...

# CHECK-LABEL: name: branch_before_return
# CHECK: bb.0:
# CHECK-NOT: successors:
# CHECK-NOT: BR
# CHECK: RET implicit undef $r1
---
name:            branch_before_return
tracksRegLiveness: true
body:             |
  bb.0:
    successors: %bb.1(0x80000000)
    BR %bb.1
    RET implicit undef $r1

  bb.1:
    RET implicit undef $r1
...
