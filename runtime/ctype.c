// SLOW-32 ctype implementation — ISO 8859-1 (Latin-1)
// Table-driven character classification and conversion.

#include <ctype.h>

// Flag bits for the classification table
#define _U  0x01  // uppercase letter
#define _L  0x02  // lowercase letter
#define _D  0x04  // digit
#define _X  0x08  // hex letter (A-F, a-f)
#define _S  0x10  // whitespace
#define _C  0x20  // control
#define _P  0x40  // punctuation/symbol
#define _B  0x80  // blank (space, tab, nbsp)

// Latin-1 classification table (256 entries, indexed by unsigned char)
//
// 0x00-0x1F: C0 controls
// 0x20-0x7E: ASCII printable
// 0x7F:      DEL (control)
// 0x80-0x9F: C1 controls
// 0xA0:      non-breaking space
// 0xA1-0xFF: Latin-1 supplement
//
// Latin-1 letters beyond ASCII:
//   Uppercase: 0xC0-0xD6 (À-Ö), 0xD8-0xDE (Ø-Þ)
//   Lowercase: 0xDF (ß), 0xE0-0xF6 (à-ö), 0xF8-0xFF (ø-ÿ)
//   Also lowercase: 0xAA (ª), 0xB5 (µ), 0xBA (º)
//   Not letters: 0xD7 (×), 0xF7 (÷)

const unsigned char __ctype_table[256] = {
    // 0x00-0x0F: C0 controls (tab, newline, vtab, formfeed, CR are also whitespace)
    _C,             // 0x00 NUL
    _C,             // 0x01 SOH
    _C,             // 0x02 STX
    _C,             // 0x03 ETX
    _C,             // 0x04 EOT
    _C,             // 0x05 ENQ
    _C,             // 0x06 ACK
    _C,             // 0x07 BEL
    _C,             // 0x08 BS
    _C|_S|_B,       // 0x09 TAB (control, whitespace, blank)
    _C|_S,          // 0x0A LF  (control, whitespace)
    _C|_S,          // 0x0B VT  (control, whitespace)
    _C|_S,          // 0x0C FF  (control, whitespace)
    _C|_S,          // 0x0D CR  (control, whitespace)
    _C,             // 0x0E SO
    _C,             // 0x0F SI

    // 0x10-0x1F: more C0 controls
    _C, _C, _C, _C, _C, _C, _C, _C,  // 0x10-0x17
    _C, _C, _C, _C, _C, _C, _C, _C,  // 0x18-0x1F

    // 0x20-0x2F: space, punctuation
    _S|_B,          // 0x20 SPACE (whitespace, blank)
    _P,             // 0x21 !
    _P,             // 0x22 "
    _P,             // 0x23 #
    _P,             // 0x24 $
    _P,             // 0x25 %
    _P,             // 0x26 &
    _P,             // 0x27 '
    _P,             // 0x28 (
    _P,             // 0x29 )
    _P,             // 0x2A *
    _P,             // 0x2B +
    _P,             // 0x2C ,
    _P,             // 0x2D -
    _P,             // 0x2E .
    _P,             // 0x2F /

    // 0x30-0x39: digits
    _D, _D, _D, _D, _D, _D, _D, _D, _D, _D,

    // 0x3A-0x40: punctuation
    _P, _P, _P, _P, _P, _P, _P,

    // 0x41-0x46: uppercase hex (A-F)
    _U|_X, _U|_X, _U|_X, _U|_X, _U|_X, _U|_X,
    // 0x47-0x5A: uppercase (G-Z)
    _U, _U, _U, _U, _U, _U, _U, _U, _U, _U,
    _U, _U, _U, _U, _U, _U, _U, _U, _U, _U,

    // 0x5B-0x60: punctuation
    _P, _P, _P, _P, _P, _P,

    // 0x61-0x66: lowercase hex (a-f)
    _L|_X, _L|_X, _L|_X, _L|_X, _L|_X, _L|_X,
    // 0x67-0x7A: lowercase (g-z)
    _L, _L, _L, _L, _L, _L, _L, _L, _L, _L,
    _L, _L, _L, _L, _L, _L, _L, _L, _L, _L,

    // 0x7B-0x7E: punctuation
    _P, _P, _P, _P,
    // 0x7F: DEL
    _C,

    // 0x80-0x9F: C1 controls
    _C, _C, _C, _C, _C, _C, _C, _C,  // 0x80-0x87
    _C, _C, _C, _C, _C, _C, _C, _C,  // 0x88-0x8F
    _C, _C, _C, _C, _C, _C, _C, _C,  // 0x90-0x97
    _C, _C, _C, _C, _C, _C, _C, _C,  // 0x98-0x9F

    // 0xA0-0xAF: Latin-1 supplement
    _S|_B,          // 0xA0 NBSP (whitespace, blank)
    _P,             // 0xA1 ¡
    _P,             // 0xA2 ¢
    _P,             // 0xA3 £
    _P,             // 0xA4 ¤
    _P,             // 0xA5 ¥
    _P,             // 0xA6 ¦
    _P,             // 0xA7 §
    _P,             // 0xA8 ¨
    _P,             // 0xA9 ©
    _L,             // 0xAA ª (feminine ordinal — lowercase letter)
    _P,             // 0xAB «
    _P,             // 0xAC ¬
    _P,             // 0xAD soft hyphen
    _P,             // 0xAE ®
    _P,             // 0xAF ¯

    // 0xB0-0xBF
    _P,             // 0xB0 °
    _P,             // 0xB1 ±
    _P,             // 0xB2 ²
    _P,             // 0xB3 ³
    _P,             // 0xB4 ´
    _L,             // 0xB5 µ (micro sign — lowercase letter)
    _P,             // 0xB6 ¶
    _P,             // 0xB7 ·
    _P,             // 0xB8 ¸
    _P,             // 0xB9 ¹
    _L,             // 0xBA º (masculine ordinal — lowercase letter)
    _P,             // 0xBB »
    _P,             // 0xBC ¼
    _P,             // 0xBD ½
    _P,             // 0xBE ¾
    _P,             // 0xBF ¿

    // 0xC0-0xCF: Latin-1 uppercase (À-Ï)
    _U, _U, _U, _U, _U, _U, _U, _U,  // 0xC0-0xC7 À-Ç
    _U, _U, _U, _U, _U, _U, _U, _U,  // 0xC8-0xCF È-Ï

    // 0xD0-0xDF
    _U,             // 0xD0 Ð
    _U,             // 0xD1 Ñ
    _U,             // 0xD2 Ò
    _U,             // 0xD3 Ó
    _U,             // 0xD4 Ô
    _U,             // 0xD5 Õ
    _U,             // 0xD6 Ö
    _P,             // 0xD7 × (multiplication sign — NOT a letter)
    _U,             // 0xD8 Ø
    _U,             // 0xD9 Ù
    _U,             // 0xDA Ú
    _U,             // 0xDB Û
    _U,             // 0xDC Ü
    _U,             // 0xDD Ý
    _U,             // 0xDE Þ
    _L,             // 0xDF ß (lowercase, no uppercase in Latin-1)

    // 0xE0-0xEF: Latin-1 lowercase (à-ï)
    _L, _L, _L, _L, _L, _L, _L, _L,  // 0xE0-0xE7 à-ç
    _L, _L, _L, _L, _L, _L, _L, _L,  // 0xE8-0xEF è-ï

    // 0xF0-0xFF
    _L,             // 0xF0 ð
    _L,             // 0xF1 ñ
    _L,             // 0xF2 ò
    _L,             // 0xF3 ó
    _L,             // 0xF4 ô
    _L,             // 0xF5 õ
    _L,             // 0xF6 ö
    _P,             // 0xF7 ÷ (division sign — NOT a letter)
    _L,             // 0xF8 ø
    _L,             // 0xF9 ù
    _L,             // 0xFA ú
    _L,             // 0xFB û
    _L,             // 0xFC ü
    _L,             // 0xFD ý
    _L,             // 0xFE þ
    _L,             // 0xFF ÿ (lowercase, uppercase Ÿ is U+0178)
};

// Latin-1 case conversion tables
// ß (0xDF), µ (0xB5), ÿ (0xFF) have no uppercase in Latin-1
// ª (0xAA), º (0xBA) have no uppercase in Latin-1

const unsigned char __toupper_table[256] = {
    0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,  // 0x00-0x07
    0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F,  // 0x08-0x0F
    0x10,0x11,0x12,0x13,0x14,0x15,0x16,0x17,  // 0x10-0x17
    0x18,0x19,0x1A,0x1B,0x1C,0x1D,0x1E,0x1F,  // 0x18-0x1F
    0x20,0x21,0x22,0x23,0x24,0x25,0x26,0x27,  // 0x20-0x27
    0x28,0x29,0x2A,0x2B,0x2C,0x2D,0x2E,0x2F,  // 0x28-0x2F
    0x30,0x31,0x32,0x33,0x34,0x35,0x36,0x37,  // 0x30-0x37
    0x38,0x39,0x3A,0x3B,0x3C,0x3D,0x3E,0x3F,  // 0x38-0x3F
    0x40,                                       // 0x40 @
    'A','B','C','D','E','F','G','H','I','J',    // 0x41-0x4A (identity)
    'K','L','M','N','O','P','Q','R','S','T',    // 0x4B-0x54
    'U','V','W','X','Y','Z',                    // 0x55-0x5A
    0x5B,0x5C,0x5D,0x5E,0x5F,0x60,             // 0x5B-0x60
    'A','B','C','D','E','F','G','H','I','J',    // 0x61-0x6A a-j → A-J
    'K','L','M','N','O','P','Q','R','S','T',    // 0x6B-0x74 k-t → K-T
    'U','V','W','X','Y','Z',                    // 0x75-0x7A u-z → U-Z
    0x7B,0x7C,0x7D,0x7E,0x7F,                  // 0x7B-0x7F
    0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,  // 0x80-0x87
    0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,  // 0x88-0x8F
    0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,  // 0x90-0x97
    0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,  // 0x98-0x9F
    0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,  // 0xA0-0xA7
    0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,  // 0xA8-0xAF (ª stays)
    0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,  // 0xB0-0xB7 (µ stays)
    0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,  // 0xB8-0xBF (º stays)
    0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,  // 0xC0-0xC7 (identity)
    0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,  // 0xC8-0xCF
    0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,  // 0xD0-0xD7
    0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,        // 0xD8-0xDE
    0xDF,                                       // 0xDF ß (no uppercase)
    0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,  // 0xE0-0xE7 à-ç → À-Ç
    0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,  // 0xE8-0xEF è-ï → È-Ï
    0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,        // 0xF0-0xF6 ð-ö → Ð-Ö
    0xF7,                                       // 0xF7 ÷ (not a letter)
    0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,        // 0xF8-0xFE ø-þ → Ø-Þ
    0xFF,                                       // 0xFF ÿ (no uppercase in Latin-1)
};

const unsigned char __tolower_table[256] = {
    0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,  // 0x00-0x07
    0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F,  // 0x08-0x0F
    0x10,0x11,0x12,0x13,0x14,0x15,0x16,0x17,  // 0x10-0x17
    0x18,0x19,0x1A,0x1B,0x1C,0x1D,0x1E,0x1F,  // 0x18-0x1F
    0x20,0x21,0x22,0x23,0x24,0x25,0x26,0x27,  // 0x20-0x27
    0x28,0x29,0x2A,0x2B,0x2C,0x2D,0x2E,0x2F,  // 0x28-0x2F
    0x30,0x31,0x32,0x33,0x34,0x35,0x36,0x37,  // 0x30-0x37
    0x38,0x39,0x3A,0x3B,0x3C,0x3D,0x3E,0x3F,  // 0x38-0x3F
    0x40,                                       // 0x40 @
    'a','b','c','d','e','f','g','h','i','j',    // 0x41-0x4A A-J → a-j
    'k','l','m','n','o','p','q','r','s','t',    // 0x4B-0x54 K-T → k-t
    'u','v','w','x','y','z',                    // 0x55-0x5A U-Z → u-z
    0x5B,0x5C,0x5D,0x5E,0x5F,0x60,             // 0x5B-0x60
    'a','b','c','d','e','f','g','h','i','j',    // 0x61-0x6A (identity)
    'k','l','m','n','o','p','q','r','s','t',    // 0x6B-0x74
    'u','v','w','x','y','z',                    // 0x75-0x7A
    0x7B,0x7C,0x7D,0x7E,0x7F,                  // 0x7B-0x7F
    0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,  // 0x80-0x87
    0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,  // 0x88-0x8F
    0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,  // 0x90-0x97
    0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,  // 0x98-0x9F
    0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,  // 0xA0-0xA7
    0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,  // 0xA8-0xAF
    0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,  // 0xB0-0xB7
    0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,  // 0xB8-0xBF
    0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,  // 0xC0-0xC7 À-Ç → à-ç
    0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,  // 0xC8-0xCF È-Ï → è-ï
    0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,        // 0xD0-0xD6 Ð-Ö → ð-ö
    0xD7,                                       // 0xD7 × (not a letter)
    0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,        // 0xD8-0xDE Ø-Þ → ø-þ
    0xDF,                                       // 0xDF ß (identity)
    0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,  // 0xE0-0xE7 (identity)
    0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,  // 0xE8-0xEF
    0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,        // 0xF0-0xF6
    0xF7,                                       // 0xF7 ÷ (not a letter)
    0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,        // 0xF8-0xFE (identity)
    0xFF,                                       // 0xFF ÿ (identity)
};

// Classification functions — single table lookup + mask test

int isalnum(int c) {
    return ((unsigned)c < 256) && (__ctype_table[c] & (_U|_L|_D));
}

int isalpha(int c) {
    return ((unsigned)c < 256) && (__ctype_table[c] & (_U|_L));
}

int isblank(int c) {
    return ((unsigned)c < 256) && (__ctype_table[c] & _B);
}

int iscntrl(int c) {
    return ((unsigned)c < 256) && (__ctype_table[c] & _C);
}

int isdigit(int c) {
    return ((unsigned)c < 256) && (__ctype_table[c] & _D);
}

int isgraph(int c) {
    return ((unsigned)c < 256) && (__ctype_table[c] & (_U|_L|_D|_P));
}

int islower(int c) {
    return ((unsigned)c < 256) && (__ctype_table[c] & _L);
}

int isprint(int c) {
    return ((unsigned)c < 256) && !(__ctype_table[c] & _C) && __ctype_table[c];
}

int ispunct(int c) {
    return ((unsigned)c < 256) && (__ctype_table[c] & _P);
}

int isspace(int c) {
    return ((unsigned)c < 256) && (__ctype_table[c] & _S);
}

int isupper(int c) {
    return ((unsigned)c < 256) && (__ctype_table[c] & _U);
}

int isxdigit(int c) {
    return ((unsigned)c < 256) && (__ctype_table[c] & (_D|_X));
}

// Conversion functions — single table lookup

int tolower(int c) {
    return ((unsigned)c < 256) ? __tolower_table[c] : c;
}

int toupper(int c) {
    return ((unsigned)c < 256) ? __toupper_table[c] : c;
}

// Non-standard but common

int isascii(int c) {
    return (unsigned)c <= 127;
}

int toascii(int c) {
    return c & 0x7F;
}
